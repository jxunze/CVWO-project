{"ast":null,"code":"import _slicedToArray from \"/Users/xunze/Local Documents/Grind/Personal Projects/CVWO/proj2/final_forum/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _this = this,\n  _jsxFileName = \"/Users/xunze/Local Documents/Grind/Personal Projects/CVWO/proj2/final_forum/frontend/src/Pages/HomePage.js\";\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate } from \"react-router-dom\";\nimport Posts from '../components/Posts';\nimport Navbar from '../components/NavBar.js';\nimport NewPost from '../components/NewPost';\nvar HomePage = function HomePage() {\n  var navigate = useNavigate();\n  var _useState = useState({\n      user: {},\n      error: \"\"\n    }),\n    _useState2 = _slicedToArray(_useState, 2),\n    userInfo = _useState2[0],\n    setInfo = _useState2[1];\n  var _useState3 = useState({\n      title: '',\n      body: ''\n    }),\n    _useState4 = _slicedToArray(_useState3, 2),\n    formInfo = _useState4[0],\n    setFormInfo = _useState4[1];\n  var _useState5 = useState([]),\n    _useState6 = _slicedToArray(_useState5, 2),\n    posts = _useState6[0],\n    setPosts = _useState6[1]; // useEffect(() => {\n  //   console.log('hit');\n  //   let token = localStorage.getItem('token');\n  //   if(token){\n  //     fetch('http://localhost:3000/profile', {\n  //       method: \"GET\",\n  //       headers: {\n  //         \"Authorization\": `Bearer ${token}`\n  //       }\n  //     })\n  //     .then(response => response.json())\n  //     .then(result => {\n  //       if(result.id){\n  //         setInfo({\n  //           ...userInfo, \n  //           user: result\n  //         })\n  //       }\n  //     })\n  //   }\n  // }, []\n  // );\n  var getPosts = function getPosts() {\n    var url = \"http://localhost:3000/posts\";\n    var token = localStorage.getItem('token');\n    if (token) {\n      fetch(url, {\n        method: \"GET\",\n        headers: {\n          \"Authorization\": \"Bearer \".concat(token)\n        }\n      }).then(function (res) {\n        if (res.ok) {\n          return res.json();\n        }\n        throw new Error(\"Network response was not ok.\");\n      }).then(function (res) {\n        setPosts(res);\n      }).catch(function () {\n        return navigate(\"/login\");\n      });\n    } else {\n      navigate(\"/login\");\n    }\n  };\n  useEffect(function () {\n    return getPosts();\n  }, []);\n  var onSubmit = function onSubmit(event, title, body) {\n    event.preventDefault();\n    var url = \"http://localhost:3000/posts\";\n    if (title.length === 0 || body.length === 0) return;\n    var info = {\n      post: {\n        title: title,\n        body: stripHtmlEntities(body)\n      }\n    };\n    var auth_token = localStorage.getItem('token');\n    fetch(url, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": \"Bearer \".concat(auth_token)\n      },\n      body: JSON.stringify(info)\n    }).then(function (response) {\n      if (response.ok) {\n        return response.json();\n      }\n      throw new Error(\"Network response was not ok.\");\n    }).then(function () {\n      getPosts();\n    }).catch(function (error) {\n      return console.log(error.message);\n    });\n  };\n  var stripHtmlEntities = function stripHtmlEntities(str) {\n    return String(str).replace(/\\n/g, \"<br> <br>\").replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\");\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Navbar, {\n    user: localStorage.getItem('username'),\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"py-5\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"main\", {\n    className: \"container\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"text-end mb-3\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(NewPost, {\n    submit: onSubmit,\n    onChange: setFormInfo,\n    info: formInfo,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 13\n    }\n  })), /*#__PURE__*/React.createElement(\"hr\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"br\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(Posts, {\n    posts: posts,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 11\n    }\n  }))));\n};\nexport default HomePage;","map":{"version":3,"names":["React","useState","useEffect","useNavigate","Posts","Navbar","NewPost","HomePage","navigate","user","error","userInfo","setInfo","title","body","formInfo","setFormInfo","posts","setPosts","getPosts","url","token","localStorage","getItem","fetch","method","headers","then","res","ok","json","Error","catch","onSubmit","event","preventDefault","length","info","post","stripHtmlEntities","auth_token","JSON","stringify","response","console","log","message","str","String","replace"],"sources":["/Users/xunze/Local Documents/Grind/Personal Projects/CVWO/proj2/final_forum/frontend/src/Pages/HomePage.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate } from \"react-router-dom\";\nimport Posts from '../components/Posts'\nimport Navbar from '../components/NavBar.js'\nimport NewPost from '../components/NewPost';\n\n\n\nconst HomePage = () => {\n  let navigate = useNavigate();\n  const [userInfo, setInfo] = useState({\n    user: {}, \n    error: \"\",\n  });\n  const [formInfo, setFormInfo] = useState({\n    title: '',\n    body: ''\n});\n\n  const [posts, setPosts] = useState([]);\n\n\n  // useEffect(() => {\n  //   console.log('hit');\n  //   let token = localStorage.getItem('token');\n  //   if(token){\n  //     fetch('http://localhost:3000/profile', {\n  //       method: \"GET\",\n  //       headers: {\n  //         \"Authorization\": `Bearer ${token}`\n  //       }\n  //     })\n  //     .then(response => response.json())\n  //     .then(result => {\n  //       if(result.id){\n  //         setInfo({\n  //           ...userInfo, \n  //           user: result\n  //         })\n  //       }\n  //     })\n  //   }\n  // }, []\n  // );\n  const getPosts = () => {\n    const url = \"http://localhost:3000/posts\";\n    let token = localStorage.getItem('token');\n    if(token){\n      fetch(url, {\n        method: \"GET\",\n        headers: {\n          \"Authorization\": `Bearer ${token}`\n        }\n      })\n        .then((res) => {\n          if (res.ok) {\n            return res.json();\n          }\n          throw new Error(\"Network response was not ok.\");\n        })\n        .then((res) => {setPosts(res);})\n        .catch(() => navigate(\"/login\"));\n    }\n    else{\n      navigate(\"/login\")\n    }\n  }\n  useEffect(() => getPosts(), []);\n\n  const onSubmit = (event, title, body) => {\n    event.preventDefault();\n    const url = \"http://localhost:3000/posts\";\n\n    if (title.length === 0 || body.length === 0)\n      return;\n    const info = {\n      post: {\n        title,\n        body: stripHtmlEntities(body),\n      }\n    };\n\n    const auth_token = localStorage.getItem('token');\n    fetch(url, {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Authorization\": `Bearer ${auth_token}`\n      },\n      body: JSON.stringify(info),\n    })\n      .then((response) => {\n        if (response.ok) {\n          return response.json();\n        }\n        throw new Error(\"Network response was not ok.\");\n      })\n      .then(()=>{\n        getPosts();\n                  })\n      .catch((error) => console.log(error.message));\n  };\n\n  const stripHtmlEntities = (str) => {\n    return String(str)\n      .replace(/\\n/g, \"<br> <br>\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\");\n  };\n  \n  return (\n    <div>\n      <Navbar user={localStorage.getItem('username')}/>\n      <div className=\"py-5\">\n        <main className=\"container\">\n          <div className=\"text-end mb-3\">\n            <NewPost submit={onSubmit} onChange={setFormInfo} info={formInfo}/>\n          </div>\n          <hr/>\n          <br/>\n          <Posts posts={posts}/>\n        </main>\n      </div>\n    </div>\n  )\n\n}\n\nexport default HomePage"],"mappings":"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"},"metadata":{},"sourceType":"module"}